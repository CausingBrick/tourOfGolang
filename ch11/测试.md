# 测试

测试是`自动化测试`的简称.用于简单的程序编写来确保程序在该测试中针对特定的输入产生特定的输出.

##  11.1 `go test`工具

* `go test`子命令是Go语言包的测试驱动程序,这些包根据某些约定组织在一起. 在一个包目录中,以`_test.go`结尾的文件是`go test`编译的目标而不是`go build`.

* 在`*_test.go`文件中,有三种函数需要特殊对待:

  1. 功能测试函数: 以`Test`前缀命名的函数,用来检测一些程序逻辑的正确性, `go test`运行测试函数, 用来检测一些程序的逻辑性. 使用`go test`运行测试函数,并且报告结果是`pass`还是`fail`.
  2. `Beachmark`函数:名称以`Benchmark`开头, 用来测试某些操作的性能, 并且`go test`汇报操作的的平均时间.
  3. 示例函数: 以`Example`开头, 用来提供机器检查过的文档.

* `go test`工具扫描`*_test.go`文件来寻找特殊函数,并生成一个临时的`main`包来调用他们, 然后编译和运行, 并汇报结果, 最后清理临时文件.

* 选项说明:

  * `-v`: 可以输出每个包中每个测试用例的名称和执行的时间.
  * `-run`:参数是一个正则表达式,可以使得只运行测试函数名称匹配给定的模式的函数.

  

## 11.2 Test函数

1. 每个测试文件必须导入`testing`包.函数签名如下:

   ```go
   func TestName(t *testing.T) {
   	//...
   }
   ```

   功能函数测试函数必须以Test开头, 可选的后缀名称必须以大写字母开头:

   ```go
   func TestSortIntSlice(t *testing.T) {
   	//...
   }
   
   ```

   参数`t`提供了汇报测试函数失败和日志记录的功能.

2. `go test (go build)`命令在不指定包参数的情况下, 以当前目录所在的包为参数执行.

3. 调用`t.Errorf`输出的失败的测试用例信息没有包含整个跟踪信息,也不会导致程序宕机或者终止执行.测试用例彼此是独立的.如果测试表中的一个条目造成测试失败, 那么其他的条目任然会继续测试, 那样我们就可以在一次测试的过程中发现多个失败的情况.

4. 若要真的终止一个函数, 比如初始化代码失败或者避免已有的错误产生不可预支的输出, 可以使用`t.Fatal`or`t.Fatalf`函数来终止测试程序.

5. 测试错误消息格式一般为`f(x) = y,want z`:

   * `f(x)`表示需要执行的操作和输入.
   * `y`是实际输出的结果.
   * `z`是期望的结果.

   错误消息要避免样板文字和多余的信息. 如果`x, y, z`都比较长, 可以输出准确代表个部分的概要信息.

6. 基于表的测试方便针对精心选择的输入检测函数是否正常工作, 以逻辑上引人关注的用例. 

### 11.2.1 随机测试

随机测试是指通过构建随机输入来拓展测试的覆盖范围.

如果给出的输入是随机的, 对于函数的输出内容的判定有两种策略:

 	1. 额外写一个函数, 这个函数使用低效但是清晰的算法吗然后检查这两种实现的输出是否一致.
 	2. 构建符合某种模式的输入, 这样可以知道对应的输出是什么.由于随机测试的不确定性, 在遇到测试用例失败的情况下, 要记录足够多的信息以便于重现问题.



### 11.2.2 测试命令

`go test` 工具对测试代码包很有用, 同时也可以将其用于测试命令.包名`main`一般会产生可执行文件, 但是也可以当做测试库来导入.

