# 程序结构 

[TOC]

##  2.1 名称

- Go 中函数,变量,常量,类型,语句标签和包的名称遵循:开头为字母或者下划线,后面跟上任意数量下划线字符与数字.
- 若在一个函数内声明实体(变量),则其只在函数局部有效.声明在函数之外,将对包里的所有源文件有效.
- 实体的第一个名称是否大写决定其是否跨包.
- 命名偏向于用驼峰式命名.

##  2.2  声明

- 有4个主要声明:变量(var),常量(const),类型(type)和函数(func).
- 包级别的实体名字不仅对于包含其声明的源文件课件,而且对于同一个包里的所有源文件都可见



## 2.3 变量

* 声明变量的通用形式

  > var name type = expression

* go变量声明特点:
  
  1. 不比强制值初始化,int自动初始化,string自动为""等.
  2. 支持同时声明不同的变量
     > var i, j, k int    //int, int, int  
     > var b,f,s = int, bool, string

###  2.31 短变量声明

* 函数里,声明初始化局部变量可以用短变量声明的形式进行,并且支持多变量声明;

  > name1, name2 := type1, type2

* `:=` 表示声明, `=` 表示赋值

  > i, j = j, i  //交换两者的值

* 若已经申明了一个变量,再继续使用 `:=` 时需保证至少还有一个新变量
  > a := 1  
  > a, err := orm.QuereTable().Values() //err 为新变量, a为赋值操作

###  2.32 指针

* 指针是变量的地址.

* ```go
  var x int
  //表达式&x 获取x的地址, 即为指向一个整型变量的指针, 其类型为 *int
  x = 1
  p = &x
  //p指向x	p包含x的地址
  //*p == 1
  *p = 2
  fmt.Println(x)	//2
  ```

* 

### 2.33 new函数

* 内置new函数可以创建变量,表达式为new(T),初始化T类型的零值,并返回地址(地址类型为*T).

  > p := new(int)

### 2.34 变量的声明周期

* 包级别的变量声明周期为整个程序执行的时间.
* 编译器可以分配堆与栈上的内存,但是与c/cpp不同,不是通过`var`或`new`来声明变量.例如:

  ```
  var global *int
  func f() {
      var x int
      x = 1
      global = &x
  }
  ```

  在此处,x使用了堆空间,因为在函数结束返回以后还可以访问,尽管其为局部变量.`这种情况称为x从f中逃逸`.
* 在写代码的时候不用去花心思考虑内存分配,但是为了高效代码或者性能优化的时候可以从此处入手,变量逃逸会需要额外的内存分配.

## 2.4 赋值

* 通过`=`进行赋值操作
  
### 2.41 多重赋值

* 在更新变量之前,右边的表达式被推演,如交换两者值
  >x, y = y. x
*对于不需要的返回值用, `_`可以代替该位置.

### 2.42 可赋值性

* 程序有两种赋值方法:  
  1. 显式赋值: 程序中使用赋值语句赋值.  
  2. 隐式赋值: 一个函数调用隐式地将参数赋值给对应参数的变量,例如:
     > medal[1] = "iron"
     > 

## 2.5 类型声明

变量或者表达式可以定义值的大小,结构,内部如何表达,但是在不同的程序中,含义差别巨大,可以使用type来定义新的命名类型.

* 语法:
  
>type name underlying-type
  
* 此处给出了类型说明的栗子,把不同的温度计量单位转换为其他的类型.[ch2 程序结构/tempconv](file/)

## 2.6 包和文件

* go支持模块化, 封装, 编译隔离和重用,这些与go的包管理密不可分.
* 一个包的源码由一个或者`.go`文件组成,不一定有main包.
* 每个文件开头用`package`声明定义包的名称,而且一般包名与文件当前文件夹同名(除开main包).
* `import`一个包时,该包即可访问,但是局部变量不能访问,包级别的类型变量函数即可调用.
* `package` 声明前面应该有文档注释对整个包进行描述. 拓展的文档注释应该放在一个文件当中,惯例命名为`doc.go`
* 包引用栗子[ch2 程序结构/tempconv](file).练习2.1同

### 2.61 导入

* 导入声明中默认可以使用匹配路径的最后一段.
  
  ```
  package main
  import "/theWayToGo/ch2 程序结构/tempconv"
  func main() {
      tempconv.FToC(f)
  }
  
  ```

* 为了避免冲突,也可以使用`修饰标识符`来表示一个包.
  > import tempconvToC "/theWayToGo/ch2 程序结构/tempconv"  
  > tempconvToC.FToC(f)

* 栗子为cf,练习2.2 

### 2.62 包初始化

* go包的初始化顺序:  
  1. 以递归的方式初始化引入的包,.
  2. 初始化包级别的变量
  3. 执行init函数.`init函数不能被调用和引用.`
* 包里若有多个.go文件,go工具会在调用编译前将.go文件进行排序.
* 初始化时,依赖顺序优先,并且其过程是自下而上的,在`main`函数开始之前,所有包已经执行完毕.


## 2.7 作用域

* 声明的作用域是指用到声明时所声明名字的源代码段。
* 作用域指的是在源码里的有效代码区域，不是生命周期．
* 语法块决定作用域

